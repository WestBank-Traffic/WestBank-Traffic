<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>خريطة مواقف الحافلات مع بيانات إضافية</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  />
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    var map = L.map("map").setView([32.0, 35.5], 10);

    L.tileLayer(
      "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
      {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        maxZoom: 20,
      }
    ).addTo(map);

    // تحميل ملف البيانات الإضافية (EX_Bus.json)
    let extraData = [];

    fetch('https://raw.githubusercontent.com/Rahaf-Yaze/Car-Stations-in-Ramallahv/main/EX_Bus.json')
      .then(response => response.json())
      .then(data => {
        extraData = data;
        loadBusData();
      })
      .catch(error => console.error('خطأ بتحميل بيانات EX_Bus.json:', error));

    // تحميل ملف النقاط Bus.geojson
    function loadBusData() {
      fetch('https://raw.githubusercontent.com/Rahaf-Yaze/Car-Stations-in-Ramallahv/main/Bus.geojson')
        .then(response => response.json())
        .then(busData => {
          var busIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/Rahaf-Yaze/Car-Stations-in-Ramallahv/main/directions_bus_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg',
            iconSize: [30, 30],
            iconAnchor: [15, 30],
            popupAnchor: [0, -30],
          });

          L.geoJSON(busData, {
            pointToLayer: function(feature, latlng) {
              return L.marker(latlng, { icon: busIcon });
            },
            onEachFeature: function(feature, layer) {
              // حقل الربط بين الملفات، عدله حسب اسم الحقل المشترك بالضبط
              const keyFieldGeoJSON = 'name';  // أو 'الاسم' حسب ملفك
              const keyFieldExtra = 'مجمع الخطوط (كراج)';

              let keyValue = feature.properties[keyFieldGeoJSON];

              // البحث عن بيانات مرتبطة في ملف EX_Bus.json
              let relatedData = extraData.find(item => item[keyFieldExtra] === keyValue);

              let popupContent = `<b>محطة:</b> ${keyValue || "غير معروف"}<br>`;

              if (relatedData) {
                // اعرض البيانات المرتبطة (غير هذا حسب حقولك)
                for (const [k, v] of Object.entries(relatedData)) {
                  popupContent += `<b>${k}:</b> ${v}<br>`;
                }
              } else {
                popupContent += "لا توجد بيانات مرتبطة.";
              }

              layer.bindPopup(popupContent);
            }
          }).addTo(map);
        })
        .catch(error => console.error('خطأ بتحميل بيانات Bus.geojson:', error));
    }
  </script>
</body>
</html>
